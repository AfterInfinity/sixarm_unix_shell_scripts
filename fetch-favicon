#!/bin/sh
set -euf -o pipefail

##
# Download a favicon.
#
# Syntax:
#
#     fetch-favicon <url>
#
# Example:
#
#     fetch-favicon www.example.com
#     => download favicon to file
#
# Author: Joel Parker Henderson (joel@joelparkerhenderson.com)
# License: GPL
# Updated: 2015-06-30
##

if [ $# -eq 0 ]
then
  echo "Syntax: fetch-favicon <url>"
  echo "Example: fetch-favicon www.example.com"
  exit
fi

page_url=$1
echo "page_url:$page_url"

icon_url=$(curl -s -S -L "$page_url" | pup 'link[rel~="icon"] attr{href}' | head -1)
echo "icon_url:$icon_url"

icon_file_name=$(echo "$icon_url" | uri-scheme file)
echo "icon_file_name:$icon_file_name"

icon_abs_url=$(uri-relate "$page_url" "$icon_url")
echo "icon_abs_url:$icon_abs_url"

curl -s -S -L "$icon_abs_url" -o "$icon_file_name"
